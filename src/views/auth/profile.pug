extends ../layout

block content
  .profile-container
    .profile-card
      .profile-header
        .user-avatar-profile
          span.avatar-text-profile= user.username.charAt(0).toUpperCase()
        h1.profile-title Ð’Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾, #{user.username}!
        span.user-badge(class=user.role === 'admin' ? 'badge-admin' : 'badge-user')= user.role
      
      .profile-body
        .profile-section
          h3 Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ñ€Ð¾ Ð¿Ñ€Ð¾Ñ„Ñ–Ð»ÑŒ
          .profile-row
            .profile-label ID:
            .profile-value= user.id
          .profile-row
            .profile-label Ð†Ð¼'Ñ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°:
            .profile-value= user.username
          .profile-row
            .profile-label Email:
            .profile-value= user.email
          .profile-row
            .profile-label Ð Ð¾Ð»ÑŒ:
            .profile-value= user.role
        
        .profile-section
          h3 ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ
          .settings-grid
            .setting-card
              h4 ðŸŽ¨ Ð¢ÐµÐ¼Ð° Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð½Ñ
              p Ð’Ð¸Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑƒÐ»ÑŽÐ±Ð»ÐµÐ½Ñƒ Ñ‚ÐµÐ¼Ñƒ Ð´Ð»Ñ ÑÐ°Ð¹Ñ‚Ñƒ
              .theme-buttons
                button#lightThemeBtn.btn.btn-theme(class=theme === 'light' ? 'active' : '') 
                  | â˜€ï¸ Ð¡Ð²Ñ–Ñ‚Ð»Ð°
                button#darkThemeBtn.btn.btn-theme(class=theme === 'dark' ? 'active' : '') 
                  | ðŸŒ™ Ð¢ÐµÐ¼Ð½Ð°
              p#themeStatus.theme-status
      
      .profile-actions
        a.btn.btn-secondary(href='/') â† ÐÐ° Ð³Ð¾Ð»Ð¾Ð²Ð½Ñƒ
        button#logoutBtn.btn.btn-danger Ð’Ð¸Ð¹Ñ‚Ð¸
  
  script.
    // Ð—Ð¼Ñ–Ð½Ð° Ñ‚ÐµÐ¼Ð¸
    document.getElementById('lightThemeBtn').addEventListener('click', async () => {
      await setTheme('light');
    });
    
    document.getElementById('darkThemeBtn').addEventListener('click', async () => {
      await setTheme('dark');
    });
    
    async function setTheme(theme) {
      try {
        const response = await fetch('/api/theme/set', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ theme })
        });
        
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('themeStatus').textContent = `Ð¢ÐµÐ¼Ñƒ Ð·Ð¼Ñ–Ð½ÐµÐ½Ð¾ Ð½Ð° "${theme}"`;
          document.getElementById('themeStatus').style.display = 'block';
          
          // Ð—Ð°ÑÑ‚Ð¾ÑÑƒÐ²Ð°Ñ‚Ð¸ Ñ‚ÐµÐ¼Ñƒ
          document.body.className = theme + '-theme';
          
          // ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñƒ ÐºÐ½Ð¾Ð¿ÐºÑƒ
          document.querySelectorAll('.btn-theme').forEach(btn => {
            btn.classList.remove('active');
          });
          document.getElementById(theme + 'ThemeBtn').classList.add('active');
          
          setTimeout(() => {
            document.getElementById('themeStatus').style.display = 'none';
          }, 3000);
        }
      } catch (error) {
        console.error('Error setting theme:', error);
      }
    }
    
    // Ð’Ð¸Ñ…Ñ–Ð´
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      try {
        const response = await fetch('/auth/logout', {
          method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
          window.location.href = '/auth/login';
        }
      } catch (error) {
        console.error('Logout error:', error);
      }
    });